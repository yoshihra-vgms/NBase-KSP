<?xml version="1.0" encoding="utf-8" ?>

<databaseConfig>

  <sql name="集計">
	  SELECT
	  MS_CARGO_YUSO_ITEM.YUSO_ITEM_CODE,
	  MS_CARGO_YUSO_ITEM.YUSO_ITEM_NAME,
	  MS_CARGO_YUSO_ITEM.SENSHU_CODE,
	  MS_CARGO_YUSO_ITEM.SENSHU_NAME,
	  PROFITS_KBN,	  
	  SUM(TKJNAIPLAN_AMT_BILL.QTY) QTY

	  FROM TKJNAIPLAN_AMT_BILL
	  inner join TKJSHIP on TKJSHIP.FUNE_NO = TKJNAIPLAN_AMT_BILL.FUNE_NO
	  inner join MS_VESSEL on MS_VESSEL.VESSEL_NO = TKJNAIPLAN_AMT_BILL.FUNE_NO
	  inner join MS_CARGO on MS_CARGO.CARGO_NO = TKJNAIPLAN_AMT_BILL.CAG_NO

	  inner join MS_CARGO_YUSO_ITEM ON MS_CARGO_YUSO_ITEM.MS_CARGO_ID = MS_CARGO.MS_CARGO_ID
	  and MS_CARGO_YUSO_ITEM.DELETE_FLAG = 0
	  and (TO_CHAR(MS_CARGO_YUSO_ITEM.START_DAY,'RRMM') &lt;= :JIKO_NO and (MS_CARGO_YUSO_ITEM.END_DAY IS NULL or TO_CHAR(MS_CARGO_YUSO_ITEM.END_DAY,'RRMM') >= :JIKO_NO) )

	  inner join (select distinct FUNE_NO,JIKO_NO,LD_DS_SET_NO from TKJNAIPLAN
	  inner join MS_BASHO on MS_BASHO.MS_BASHO_NO = TKJNAIPLAN.PORT_NO
	  where MS_BASHO.GAICHI_FLAG = 0
	  )GAICHI_TBL on GAICHI_TBL.FUNE_NO = TKJNAIPLAN_AMT_BILL.FUNE_NO and GAICHI_TBL.LD_DS_SET_NO = TKJNAIPLAN_AMT_BILL.LD_DS_SET_NO


	  WHERE TKJNAIPLAN_AMT_BILL.JIKO_NO = :JIKO_NO
	  and MS_VESSEL.DOUSEI_REPORT2 = 1

	  GROUP BY
	  PROFITS_KBN,
	  MS_CARGO_YUSO_ITEM.YUSO_ITEM_CODE,
	  MS_CARGO_YUSO_ITEM.YUSO_ITEM_NAME,
	  MS_CARGO_YUSO_ITEM.SENSHU_CODE,
	  MS_CARGO_YUSO_ITEM.SENSHU_NAME

	  HAVING SUM(TKJNAIPLAN_AMT_BILL.QTY) > 0

	  ORDER BY MS_CARGO_YUSO_ITEM.YUSO_ITEM_CODE
  </sql>



	<sql name="荷主取得">
		SELECT
		MS_CARGO_YUSO_ITEM.YUSO_ITEM_CODE,
		MS_CARGO.CARGO_NAME,
		MS_CARGO.NINUSHI,
		PROFITS_KBN,
		SUM(TKJNAIPLAN_AMT_BILL.QTY) QTY

		FROM TKJNAIPLAN_AMT_BILL
		inner join TKJSHIP on TKJSHIP.FUNE_NO = TKJNAIPLAN_AMT_BILL.FUNE_NO
		inner join MS_VESSEL on MS_VESSEL.VESSEL_NO = TKJNAIPLAN_AMT_BILL.FUNE_NO
		inner join MS_CARGO on MS_CARGO.CARGO_NO = TKJNAIPLAN_AMT_BILL.CAG_NO

		inner join MS_CARGO_YUSO_ITEM ON MS_CARGO_YUSO_ITEM.MS_CARGO_ID = MS_CARGO.MS_CARGO_ID
		and MS_CARGO_YUSO_ITEM.DELETE_FLAG = 0
		and (TO_CHAR(MS_CARGO_YUSO_ITEM.START_DAY,'RRMM') &lt;= :JIKO_NO and (MS_CARGO_YUSO_ITEM.END_DAY IS NULL or TO_CHAR(MS_CARGO_YUSO_ITEM.END_DAY,'RRMM') >= :JIKO_NO) )

		inner join (select distinct FUNE_NO,JIKO_NO,LD_DS_SET_NO from TKJNAIPLAN
		inner join MS_BASHO on MS_BASHO.MS_BASHO_NO = TKJNAIPLAN.PORT_NO
		where MS_BASHO.GAICHI_FLAG = 0
		)GAICHI_TBL on GAICHI_TBL.FUNE_NO = TKJNAIPLAN_AMT_BILL.FUNE_NO and GAICHI_TBL.LD_DS_SET_NO = TKJNAIPLAN_AMT_BILL.LD_DS_SET_NO


		WHERE TKJNAIPLAN_AMT_BILL.JIKO_NO = :JIKO_NO
		and MS_VESSEL.DOUSEI_REPORT2 = 1
		and MS_CARGO.NINUSHI IS NOT NULL

		GROUP BY
		MS_CARGO_YUSO_ITEM.YUSO_ITEM_CODE,
		MS_CARGO.CARGO_NAME,
		MS_CARGO.NINUSHI,
		PROFITS_KBN

		HAVING SUM(TKJNAIPLAN_AMT_BILL.QTY) > 0

		ORDER BY MS_CARGO_YUSO_ITEM.YUSO_ITEM_CODE
	</sql>
	
</databaseConfig>
