<?xml version="1.0" encoding="utf-8" ?>

<databaseConfig>

  <sql name="GetRecordsヘッダー">
    SELECT
    f.ORDER_THI_IRAI_STATUS as "状況",
    g.THI_IRAI_SBT_NAME as "手配依頼種別",
    h.THI_IRAI_SHOUSAI_NAME as "手配依頼詳細種別",
    a.TEHAI_IRAI_NO as "手配依頼番号",
    i.VESSEL_NAME as "船",
    a.BASHO as "場所",
    j.SEI || ' ' || j.MEI as "手配依頼者",
    k.SEI || ' ' || k.MEI as "事務担当者",
    a.NAIYOU as "手配内容",
    a.BIKOU as "備考",
    b.MM_NO as "見積番号",
    c.MK_NO as "見積回答番号",
    l.CUSTOMER_NAME as "見積依頼先",
    c.TANTOUSHA as "見積依頼先_担当者",
    CASE
    WHEN c.TANTOU_MAIL_ADDRESS IS NULL THEN '未送信'
    ELSE '送信済'
    END "メール送信状況",
    CASE
    WHEN c.TANTOU_MAIL_ADDRESS IS NULL THEN NULL
    ELSE c.CREATE_DATE
    END "送信日時",
    c.MK_KIGEN as "見積回答期限",
    m.SHIHARAI_JOUKEN_NAME as "支払条件",
    n.NYUKYO_KAMOKU_NAME as "入渠科目",
    b.OKURISAKI as "送り先",
    b.NAIYOU as "内容",
    c.MK_DATE as "見積回答日",
    c.MK_YUKOU_KIGEN as "見積有効期限",
    c.NOUKI as "納期",
    c.KOUKI as "工期",
    c.AMOUNT as "見積_金額",
    c.TAX as "見積_消費税",
    c.CARRIAGE as "見積_送料運搬料",
    c.MK_AMOUNT as "見積_値引",
    c.AMOUNT-c.MK_AMOUNT+c.CARRIAGE as "見積_合計金額(税抜)",
    c.HACHU_NO as "発注番号",
    c.HACHU_DATE as "発注日",
    d.JRY_NO as "受領番号",
    d.JRY_DATE as "受領日",
    d.AMOUNT as "納品額",
    d.TAX as "納品_消費税",
    d.CARRIAGE as "納品_送料運搬料",
    d.NEBIKI_AMOUNT as "納品_値引",
    d.AMOUNT-d.NEBIKI_AMOUNT+d.CARRIAGE as "納品_合計金額(税抜)",
    e.SHR_NO as "支払番号",
    e.NAIYOU as "摘要",
    o.SEI || ' ' || o.MEI as "申請担当者",
    e.SHR_IRAI_DATE as "請求書日",
    e.KIHYOUBI as "起票日",
    e.KEIJO_DATE as "計上日",
    e.SHR_DATE as "支払日",
    e.KIKAN_SYSTEM_SHR_NO as "基幹システム支払番号",
    e.AMOUNT as "支払額",
    e.TAX as "支払_消費税",
    e.CARRIAGE as "支払_送料運搬料",
    e.NEBIKI_AMOUNT as "請求値引",
    e.AMOUNT-e.NEBIKI_AMOUNT+e.CARRIAGE as "支払_合計金額(税抜)",
    p.AMOUNT-p.NEBIKI_AMOUNT+p.CARRIAGE as "落成_合計金額(税抜)"

    ,d.STATUS as "受領ステータス"
    ,e.STATUS as "支払ステータス"

    FROM
    OD_THI a
    LEFT JOIN OD_MM b ON b.OD_THI_ID = a.OD_THI_ID AND b.CANCEL_FLAG = 0
    LEFT JOIN OD_MK c ON c.OD_MM_ID = b.OD_MM_ID AND c.CANCEL_FLAG = 0
    LEFT JOIN OD_JRY d ON d.OD_MK_ID = c.OD_MK_ID AND d.CANCEL_FLAG = 0
    LEFT JOIN OD_SHR e ON e.OD_JRY_ID = d.OD_JRY_ID AND e.CANCEL_FLAG = 0 AND e.SBT = 0
    INNER JOIN MS_THI_IRAI_STATUS f ON f.MS_THI_IRAI_STATUS_ID = a.MS_THI_IRAI_STATUS_ID
    INNER JOIN MS_THI_IRAI_SBT g ON g.MS_THI_IRAI_SBT_ID = a.MS_THI_IRAI_SBT_ID
    LEFT JOIN MS_THI_IRAI_SHOUSAI h ON h.MS_THI_IRAI_SHOUSAI_ID = a.MS_THI_IRAI_SHOUSAI_ID
    INNER JOIN MS_VESSEL i ON i.MS_VESSEL_ID = a.MS_VESSEL_ID
    INNER JOIN MS_USER j ON j.MS_USER_ID = a.THI_USER_ID
    LEFT JOIN MS_USER k ON k.MS_USER_ID = a.JIM_TANTOU_ID
    LEFT JOIN MS_CUSTOMER l ON c.MS_CUSTOMER_ID = l.MS_CUSTOMER_ID
    LEFT JOIN MS_SHR_JOUKEN m ON b.MS_SHR_JOUKEN_ID = m.MS_SHR_JOUKEN_ID
    LEFT JOIN MS_NYUKYO_KAMOKU n ON n.MS_NYUKYO_KAMOKU_ID = b.MS_NYUKYO_KAMOKU_ID
    LEFT JOIN MS_USER o ON o.MS_USER_ID = e.SHR_TANTOU
    LEFT JOIN OD_SHR p ON p.OD_JRY_ID = d.OD_JRY_ID AND p.CANCEL_FLAG = 0 AND p.SBT = 1
    WHERE
    a.CANCEL_FLAG = 0
  </sql>

  <sql name="GetRecords詳細品目">
    SELECT
    f.ORDER_THI_IRAI_STATUS as "状況",
    g.THI_IRAI_SBT_NAME as "手配依頼種別",
    h.THI_IRAI_SHOUSAI_NAME as "手配依頼詳細種別",
    a.TEHAI_IRAI_NO as "手配依頼番号",
    i.VESSEL_NAME as "船",
    a.BASHO as "場所",
    j.SEI || ' ' || j.MEI as "手配依頼者",
    k.SEI || ' ' || k.MEI as "事務担当者",
    a.NAIYOU as "手配内容",
    a.BIKOU as "備考",
    b.MM_NO as "見積番号",
    c.MK_NO as "見積回答番号",
    l.CUSTOMER_NAME as "見積依頼先",
    c.TANTOUSHA as "見積依頼先_担当者",
    CASE
    WHEN c.TANTOU_MAIL_ADDRESS IS NULL THEN '未送信'
    ELSE '送信済'
    END "メール送信状況",
    CASE
    WHEN c.TANTOU_MAIL_ADDRESS IS NULL THEN NULL
    ELSE c.CREATE_DATE
    END "送信日時",
    c.HACHU_DATE as "発注日",
    d.JRY_DATE as "受領日",
    a.OD_THI_ID,
    b.OD_MM_ID,
    c.OD_MK_ID,
    d.OD_JRY_ID,
    e.OD_SHR_ID

    FROM
    OD_THI a
    LEFT JOIN OD_MM b ON b.OD_THI_ID = a.OD_THI_ID AND b.CANCEL_FLAG = 0
    LEFT JOIN OD_MK c ON c.OD_MM_ID = b.OD_MM_ID AND c.CANCEL_FLAG = 0
    LEFT JOIN OD_JRY d ON d.OD_MK_ID = c.OD_MK_ID AND d.CANCEL_FLAG = 0
    LEFT JOIN OD_SHR e ON e.OD_JRY_ID = d.OD_JRY_ID AND e.CANCEL_FLAG = 0 AND e.SBT = 0
    INNER JOIN MS_THI_IRAI_STATUS f ON f.MS_THI_IRAI_STATUS_ID = a.MS_THI_IRAI_STATUS_ID
    INNER JOIN MS_THI_IRAI_SBT g ON g.MS_THI_IRAI_SBT_ID = a.MS_THI_IRAI_SBT_ID
    LEFT JOIN MS_THI_IRAI_SHOUSAI h ON h.MS_THI_IRAI_SHOUSAI_ID = a.MS_THI_IRAI_SHOUSAI_ID
    INNER JOIN MS_VESSEL i ON i.MS_VESSEL_ID = a.MS_VESSEL_ID
    INNER JOIN MS_USER j ON j.MS_USER_ID = a.THI_USER_ID
    LEFT JOIN MS_USER k ON k.MS_USER_ID = a.JIM_TANTOU_ID
    LEFT JOIN MS_CUSTOMER l ON c.MS_CUSTOMER_ID = l.MS_CUSTOMER_ID
    WHERE
    a.CANCEL_FLAG = 0
  </sql>

  <sql name="FilterByMsVesselId">
    AND a.MS_VESSEL_ID = :MS_VESSEL_ID
  </sql>
  <sql name="FilterByMsCustomerId">
    AND c.MS_CUSTOMER_ID = :MS_CUSTOMER_ID
  </sql>
  <sql name="FilterByThiIraiSbtID">
    AND a.MS_THI_IRAI_SBT_ID = :MS_THI_IRAI_SBT_ID
  </sql>
  <sql name="FilterByThiIraiShousaiID">
    AND a.MS_THI_IRAI_SHOUSAI_ID = :MS_THI_IRAI_SHOUSAI_ID
  </sql>
  <sql name="FilterByMsThiIraiStatusID">
    AND a.MS_THI_IRAI_STATUS_ID IN ( #INNER_SQL_MS_THI_IRAI_STATUS_IDS# )
  </sql>
  <sql name="FilterByThiIraiDateFrom">
    AND TO_CHAR(a.THI_IRAI_DATE,'YYYY/MM/DD') >= :THI_IRAI_DATE_FROM
  </sql>
  <sql name="FilterByThiIraiDateTo">
    AND TO_CHAR(a.THI_IRAI_DATE,'YYYY/MM/DD') &lt;= :THI_IRAI_DATE_TO
  </sql>
  <sql name="FilterByThiIraiDateFromTo">
    AND TO_CHAR(a.THI_IRAI_DATE,'YYYY/MM/DD') >= :THI_IRAI_DATE_FROM
    AND TO_CHAR(a.THI_IRAI_DATE,'YYYY/MM/DD') &lt;= :THI_IRAI_DATE_TO
  </sql>
  <sql name="FilterByHachuDateFrom">
    AND TO_CHAR(c.HACHU_DATE,'YYYY/MM/DD') >= :HACHU_DATE_FROM
  </sql>
  <sql name="FilterByHachuDateTo">
    AND TO_CHAR(c.HACHU_DATE,'YYYY/MM/DD') &lt;= :HACHU_DATE_TO
  </sql>
  <sql name="FilterByHachuDateFromTo">
    AND TO_CHAR(c.HACHU_DATE,'YYYY/MM/DD') >= :HACHU_DATE_FROM
    AND TO_CHAR(c.HACHU_DATE,'YYYY/MM/DD') &lt;= :HACHU_DATE_TO
  </sql>
  <sql name="FilterByJryDateFrom">
    AND TO_CHAR(d.JRY_DATE,'YYYY/MM/DD') >= :JRY_DATE_FROM
  </sql>
  <sql name="FilterByJryDateTo">
    AND TO_CHAR(d.JRY_DATE,'YYYY/MM/DD') &lt;= :JRY_DATE_TO
  </sql>
  <sql name="FilterByJryDateFromTo">
    AND TO_CHAR(d.JRY_DATE,'YYYY/MM/DD') >= :JRY_DATE_FROM
    AND TO_CHAR(d.JRY_DATE,'YYYY/MM/DD') &lt;= :JRY_DATE_TO
  </sql>
  
  <sql name="FilterByShrDateFrom">
    AND TO_CHAR(e.SHR_DATE,'YYYY/MM/DD') >= :SHR_DATE_FROM
  </sql>
  <sql name="FilterByShrDateTo">
    AND TO_CHAR(e.SHR_DATE,'YYYY/MM/DD') &lt;= :SHR_DATE_TO
  </sql>
  <sql name="FilterByShrDateFromTo">
    AND TO_CHAR(e.SHR_DATE,'YYYY/MM/DD') >= :SHR_DATE_FROM
    AND TO_CHAR(e.SHR_DATE,'YYYY/MM/DD') &lt;= :SHR_DATE_TO
  </sql>
  
  <sql name="FilterByThiIraiNoFrom">
    AND a.TEHAI_IRAI_NO >= :TEHAI_IRAI_NO_FROM
  </sql>
  <sql name="FilterByThiIraiNoTo">
    AND a.TEHAI_IRAI_NO &lt;= :TEHAI_IRAI_NO_TO
  </sql>
  <sql name="FilterByThiIraiNoFromTo">
    AND a.TEHAI_IRAI_NO >= :TEHAI_IRAI_NO_FROM
    AND a.TEHAI_IRAI_NO &lt;= :TEHAI_IRAI_NO_TO
  </sql>

  <sql name="FilterByHeaderOrder">
    ORDER BY a.MS_THI_IRAI_STATUS_ID, i.SHOW_ORDER, i.VESSEL_NO, a.MS_THI_IRAI_SBT_ID,  a.MS_THI_IRAI_SHOUSAI_ID,  a.TEHAI_IRAI_NO
  </sql>



  <sql name="GetRecords手配詳細">
    select
    OD_THI_ITEM.HEADER,
    MS_ITEM_SBT.ITEM_SBT_NAME as MS_ITEM_SBT_NAME,
    OD_THI_ITEM.ITEM_NAME,
    OD_THI_ITEM.BIKOU,
    OD_THI_SHOUSAI_ITEM.SHOUSAI_ITEM_NAME,
    MS_VESSEL_ITEM.VESSEL_ITEM_NAME as MS_VESSEL_ITEM_NAME,
    MS_LO.LO_NAME as MS_LO_NAME,
    OD_THI_SHOUSAI_ITEM.BIKOU as SHOUSAI_BIKOU,
    MS_TANI.TANI_NAME as MS_TANI_NAME,
    OD_THI_SHOUSAI_ITEM.ZAIKO_COUNT,
    OD_THI_SHOUSAI_ITEM.SATEISU

    FROM OD_THI_ITEM
    INNER JOIN OD_THI_SHOUSAI_ITEM ON OD_THI_SHOUSAI_ITEM.OD_THI_ITEM_ID = OD_THI_ITEM.OD_THI_ITEM_ID AND OD_THI_SHOUSAI_ITEM.CANCEL_FLAG = 0
    LEFT JOIN MS_ITEM_SBT ON OD_THI_ITEM.MS_ITEM_SBT_ID = MS_ITEM_SBT.MS_ITEM_SBT_ID
    LEFT JOIN MS_VESSEL_ITEM ON OD_THI_SHOUSAI_ITEM.MS_VESSEL_ITEM_ID = MS_VESSEL_ITEM.MS_VESSEL_ITEM_ID
    LEFT JOIN MS_LO ON OD_THI_SHOUSAI_ITEM.MS_LO_ID = MS_LO.MS_LO_ID
    LEFT JOIN MS_TANI ON OD_THI_SHOUSAI_ITEM.MS_TANI_ID = MS_TANI.MS_TANI_ID

    WHERE
    OD_THI_ITEM.CANCEL_FLAG = 0
    AND OD_THI_ITEM.OD_THI_ID = :OD_THI_ID

    ORDER BY OD_THI_ITEM.SHOW_ORDER, OD_THI_SHOUSAI_ITEM.SHOW_ORDER
  </sql>

  <sql name="GetRecords見積詳細">
    select
    OD_MM_ITEM.HEADER,
    MS_ITEM_SBT.ITEM_SBT_NAME as MS_ITEM_SBT_NAME,
    OD_MM_ITEM.ITEM_NAME,
    OD_MM_ITEM.BIKOU,
    OD_MM_SHOUSAI_ITEM.SHOUSAI_ITEM_NAME,
    MS_VESSEL_ITEM.VESSEL_ITEM_NAME as MS_VESSEL_ITEM_NAME,
    MS_LO.LO_NAME as MS_LO_NAME,
    OD_MM_SHOUSAI_ITEM.BIKOU as SHOUSAI_BIKOU,
    MS_TANI.TANI_NAME as MS_TANI_NAME,
    OD_MM_SHOUSAI_ITEM.COUNT

    FROM OD_MM_ITEM
    INNER JOIN OD_MM_SHOUSAI_ITEM ON OD_MM_SHOUSAI_ITEM.OD_MM_ITEM_ID = OD_MM_ITEM.OD_MM_ITEM_ID AND OD_MM_SHOUSAI_ITEM.CANCEL_FLAG = 0
    LEFT JOIN MS_ITEM_SBT ON OD_MM_ITEM.MS_ITEM_SBT_ID = MS_ITEM_SBT.MS_ITEM_SBT_ID
    LEFT JOIN MS_VESSEL_ITEM ON OD_MM_SHOUSAI_ITEM.MS_VESSEL_ITEM_ID = MS_VESSEL_ITEM.MS_VESSEL_ITEM_ID
    LEFT JOIN MS_LO ON OD_MM_SHOUSAI_ITEM.MS_LO_ID = MS_LO.MS_LO_ID
    LEFT JOIN MS_TANI ON OD_MM_SHOUSAI_ITEM.MS_TANI_ID = MS_TANI.MS_TANI_ID

    WHERE
    OD_MM_ITEM.CANCEL_FLAG = 0
    AND OD_MM_ITEM.OD_MM_ID = :OD_MM_ID

    ORDER BY OD_MM_ITEM.SHOW_ORDER, OD_MM_SHOUSAI_ITEM.SHOW_ORDER
  </sql>

  <sql name="GetRecords回答詳細">
    select
    OD_MK_ITEM.HEADER,
    MS_ITEM_SBT.ITEM_SBT_NAME as MS_ITEM_SBT_NAME,
    OD_MK_ITEM.ITEM_NAME,
    OD_MK_ITEM.BIKOU,
    OD_MK_SHOUSAI_ITEM.SHOUSAI_ITEM_NAME,
    MS_VESSEL_ITEM.VESSEL_ITEM_NAME as MS_VESSEL_ITEM_NAME,
    MS_LO.LO_NAME as MS_LO_NAME,
    OD_MK_SHOUSAI_ITEM.BIKOU as SHOUSAI_BIKOU,
    MS_TANI.TANI_NAME as MS_TANI_NAME,
    OD_MK_SHOUSAI_ITEM.COUNT,
    OD_MK_SHOUSAI_ITEM.TANKA

    FROM OD_MK_ITEM
    INNER JOIN OD_MK_SHOUSAI_ITEM ON OD_MK_SHOUSAI_ITEM.OD_MK_ITEM_ID = OD_MK_ITEM.OD_MK_ITEM_ID AND OD_MK_SHOUSAI_ITEM.CANCEL_FLAG = 0
    LEFT JOIN MS_ITEM_SBT ON OD_MK_ITEM.MS_ITEM_SBT_ID = MS_ITEM_SBT.MS_ITEM_SBT_ID
    LEFT JOIN MS_VESSEL_ITEM ON OD_MK_SHOUSAI_ITEM.MS_VESSEL_ITEM_ID = MS_VESSEL_ITEM.MS_VESSEL_ITEM_ID
    LEFT JOIN MS_LO ON OD_MK_SHOUSAI_ITEM.MS_LO_ID = MS_LO.MS_LO_ID
    LEFT JOIN MS_TANI ON OD_MK_SHOUSAI_ITEM.MS_TANI_ID = MS_TANI.MS_TANI_ID

    WHERE
    OD_MK_ITEM.CANCEL_FLAG = 0
    AND OD_MK_ITEM.OD_MK_ID = :OD_MK_ID

    ORDER BY OD_MK_ITEM.SHOW_ORDER, OD_MK_SHOUSAI_ITEM.SHOW_ORDER
  </sql>

  <sql name="GetRecords受領詳細">
    select
    OD_JRY_ITEM.HEADER,
    MS_ITEM_SBT.ITEM_SBT_NAME as MS_ITEM_SBT_NAME,
    OD_JRY_ITEM.ITEM_NAME,
    OD_JRY_ITEM.BIKOU,
    OD_JRY_SHOUSAI_ITEM.SHOUSAI_ITEM_NAME,
    MS_VESSEL_ITEM.VESSEL_ITEM_NAME as MS_VESSEL_ITEM_NAME,
    MS_LO.LO_NAME as MS_LO_NAME,
    OD_JRY_SHOUSAI_ITEM.BIKOU as SHOUSAI_BIKOU,
    MS_TANI.TANI_NAME as MS_TANI_NAME,
    OD_JRY_SHOUSAI_ITEM.JRY_COUNT,
    OD_JRY_SHOUSAI_ITEM.TANKA

    FROM OD_JRY_ITEM
    INNER JOIN OD_JRY_SHOUSAI_ITEM ON OD_JRY_SHOUSAI_ITEM.OD_JRY_ITEM_ID = OD_JRY_ITEM.OD_JRY_ITEM_ID AND OD_JRY_SHOUSAI_ITEM.CANCEL_FLAG = 0
    LEFT JOIN MS_ITEM_SBT ON OD_JRY_ITEM.MS_ITEM_SBT_ID = MS_ITEM_SBT.MS_ITEM_SBT_ID
    LEFT JOIN MS_VESSEL_ITEM ON OD_JRY_SHOUSAI_ITEM.MS_VESSEL_ITEM_ID = MS_VESSEL_ITEM.MS_VESSEL_ITEM_ID
    LEFT JOIN MS_LO ON OD_JRY_SHOUSAI_ITEM.MS_LO_ID = MS_LO.MS_LO_ID
    LEFT JOIN MS_TANI ON OD_JRY_SHOUSAI_ITEM.MS_TANI_ID = MS_TANI.MS_TANI_ID

    WHERE
    OD_JRY_ITEM.CANCEL_FLAG = 0
    AND OD_JRY_ITEM.OD_JRY_ID = :OD_JRY_ID

    ORDER BY OD_JRY_ITEM.SHOW_ORDER, OD_JRY_SHOUSAI_ITEM.SHOW_ORDER
  </sql>
  
  <sql name="GetRecords支払詳細">
    select
    OD_SHR_ITEM.HEADER,
    MS_ITEM_SBT.ITEM_SBT_NAME as MS_ITEM_SBT_NAME,
    OD_SHR_ITEM.ITEM_NAME,
    OD_SHR_ITEM.BIKOU,
    OD_SHR_SHOUSAI_ITEM.SHOUSAI_ITEM_NAME,
    MS_VESSEL_ITEM.VESSEL_ITEM_NAME as MS_VESSEL_ITEM_NAME,
    MS_LO.LO_NAME as MS_LO_NAME,
    OD_SHR_SHOUSAI_ITEM.BIKOU as SHOUSAI_BIKOU,
    MS_TANI.TANI_NAME as MS_TANI_NAME,
    OD_SHR_SHOUSAI_ITEM.COUNT,
    OD_SHR_SHOUSAI_ITEM.TANKA

    FROM OD_SHR_ITEM
    INNER JOIN OD_SHR_SHOUSAI_ITEM ON OD_SHR_SHOUSAI_ITEM.OD_SHR_ITEM_ID = OD_SHR_ITEM.OD_SHR_ITEM_ID AND OD_SHR_SHOUSAI_ITEM.CANCEL_FLAG = 0
    LEFT JOIN MS_ITEM_SBT ON OD_SHR_ITEM.MS_ITEM_SBT_ID = MS_ITEM_SBT.MS_ITEM_SBT_ID
    LEFT JOIN MS_VESSEL_ITEM ON OD_SHR_SHOUSAI_ITEM.MS_VESSEL_ITEM_ID = MS_VESSEL_ITEM.MS_VESSEL_ITEM_ID
    LEFT JOIN MS_LO ON OD_SHR_SHOUSAI_ITEM.MS_LO_ID = MS_LO.MS_LO_ID
    LEFT JOIN MS_TANI ON OD_SHR_SHOUSAI_ITEM.MS_TANI_ID = MS_TANI.MS_TANI_ID

    WHERE
    OD_SHR_ITEM.CANCEL_FLAG = 0
    AND OD_SHR_ITEM.OD_SHR_ID = :OD_SHR_ID

    ORDER BY OD_SHR_ITEM.SHOW_ORDER, OD_SHR_SHOUSAI_ITEM.SHOW_ORDER
  </sql>
  
</databaseConfig>