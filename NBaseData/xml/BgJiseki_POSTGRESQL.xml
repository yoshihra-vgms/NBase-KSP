<?xml version="1.0" encoding="utf-8" ?>

<databaseConfig>

	<sql name="GetRecords">
    SELECT
    BG_JISEKI.JISEKI_ID,
    BG_JISEKI.MS_VESSEL_ID,
    BG_JISEKI.MS_KAMOKU_ID,
    BG_JISEKI.JISEKI_DATE,
    BG_JISEKI.KIKAN_NO,
    BG_JISEKI.YEN_AMOUNT,
    BG_JISEKI.DOLLER_AMOUNT,
    BG_JISEKI.AMOUNT,
    BG_JISEKI.OD_SHR_ID,
    BG_JISEKI.RENEW_DATE,
    BG_JISEKI.RENEW_USER_ID,
    BG_JISEKI.TS
    FROM BG_JISEKI
  </sql>

  <sql name="GetRecordsByMsVesselID">
    SELECT
    BG_JISEKI.JISEKI_ID,
    BG_JISEKI.MS_VESSEL_ID,
    BG_JISEKI.MS_KAMOKU_ID,
    BG_JISEKI.JISEKI_DATE,
    BG_JISEKI.KIKAN_NO,
    BG_JISEKI.YEN_AMOUNT,
    BG_JISEKI.DOLLER_AMOUNT,
    BG_JISEKI.AMOUNT,
    BG_JISEKI.OD_SHR_ID,
    BG_JISEKI.RENEW_DATE,
    BG_JISEKI.RENEW_USER_ID,
    BG_JISEKI.TS
    FROM BG_JISEKI

    WHERE
    BG_JISEKI.MS_VESSEL_ID = :MS_VESSEL_ID

  </sql>

  <sql name="GetRecords_年単位_船">
    SELECT
    BG_JISEKI.MS_VESSEL_ID,
    BG_JISEKI.MS_KAMOKU_ID,
    SUM(BG_JISEKI.YEN_AMOUNT) AS YEN_AMOUNT,
    SUM(BG_JISEKI.DOLLER_AMOUNT) AS DOLLER_AMOUNT,
    SUM(BG_JISEKI.AMOUNT) AS AMOUNT

    FROM BG_JISEKI

    WHERE
    BG_JISEKI.MS_VESSEL_ID = :MS_VESSEL_ID
    AND
    BG_JISEKI.JISEKI_DATE >= :JISEKI_DATE_START
    AND
    BG_JISEKI.JISEKI_DATE &lt;= :JISEKI_DATE_END

    GROUP BY MS_VESSEL_ID, MS_KAMOKU_ID
    ORDER BY MS_VESSEL_ID, MS_KAMOKU_ID
  </sql>

  <sql name="GetRecords_年単位_全社">
    SELECT
    BG_JISEKI.MS_KAMOKU_ID,
    SUM(BG_JISEKI.YEN_AMOUNT) AS YEN_AMOUNT,
    SUM(BG_JISEKI.DOLLER_AMOUNT) AS DOLLER_AMOUNT,
    SUM(BG_JISEKI.AMOUNT) AS AMOUNT

    FROM BG_JISEKI

    WHERE
    BG_JISEKI.JISEKI_DATE >= :JISEKI_DATE_START
    AND
    BG_JISEKI.JISEKI_DATE &lt;= :JISEKI_DATE_END

    GROUP BY MS_KAMOKU_ID
    ORDER BY MS_KAMOKU_ID
  </sql>

  <sql name="GetRecords_年単位_グループ">
    SELECT
    BG_JISEKI.MS_KAMOKU_ID,
    SUM(BG_JISEKI.YEN_AMOUNT) AS YEN_AMOUNT,
    SUM(BG_JISEKI.DOLLER_AMOUNT) AS DOLLER_AMOUNT,
    SUM(BG_JISEKI.AMOUNT) AS AMOUNT

    FROM BG_JISEKI

    INNER JOIN
    MS_VESSEL ON MS_VESSEL.MS_VESSEL_ID = BG_JISEKI.MS_VESSEL_ID

    INNER JOIN
    MS_VESSEL_TYPE ON MS_VESSEL_TYPE.MS_VESSEL_TYPE_ID = MS_VESSEL.MS_VESSEL_TYPE_ID

    WHERE
    MS_VESSEL_TYPE.MS_VESSEL_TYPE_ID = :MS_VESSEL_TYPE_ID
    AND
    BG_JISEKI.JISEKI_DATE >= :JISEKI_DATE_START
    AND
    BG_JISEKI.JISEKI_DATE &lt;= :JISEKI_DATE_END

    GROUP BY MS_KAMOKU_ID
    ORDER BY MS_KAMOKU_ID
  </sql>

  <sql name="GetRecords_月単位_船">
    SELECT
    BG_JISEKI.MS_VESSEL_ID,
    BG_JISEKI.MS_KAMOKU_ID,
    BG_JISEKI.JISEKI_DATE,
    SUM(BG_JISEKI.YEN_AMOUNT) AS YEN_AMOUNT,
    SUM(BG_JISEKI.DOLLER_AMOUNT) AS DOLLER_AMOUNT,
    SUM(BG_JISEKI.AMOUNT) AS AMOUNT

    FROM BG_JISEKI

    WHERE
    BG_JISEKI.MS_VESSEL_ID = :MS_VESSEL_ID
    AND
    BG_JISEKI.JISEKI_DATE >= :JISEKI_DATE_START
    AND
    BG_JISEKI.JISEKI_DATE &lt;= :JISEKI_DATE_END

    GROUP BY MS_VESSEL_ID, JISEKI_DATE, MS_KAMOKU_ID
    ORDER BY MS_VESSEL_ID, JISEKI_DATE, MS_KAMOKU_ID
  </sql>

	<sql name="GetRecords_月単位_全社">
		SELECT
		BG_JISEKI.MS_KAMOKU_ID,
		BG_JISEKI.JISEKI_DATE,
		SUM(BG_JISEKI.YEN_AMOUNT) AS YEN_AMOUNT,
		SUM(BG_JISEKI.DOLLER_AMOUNT) AS DOLLER_AMOUNT,
		SUM(BG_JISEKI.AMOUNT) AS AMOUNT


		FROM BG_JISEKI

		WHERE
		BG_JISEKI.JISEKI_DATE >= :JISEKI_DATE_START
		AND
		BG_JISEKI.JISEKI_DATE &lt;= :JISEKI_DATE_END

		GROUP BY MS_KAMOKU_ID, JISEKI_DATE
		ORDER BY MS_KAMOKU_ID, JISEKI_DATE
	</sql>

	<sql name="GetRecords_月単位_グループ">
		SELECT
		BG_JISEKI.MS_KAMOKU_ID,
		BG_JISEKI.JISEKI_DATE,
		SUM(BG_JISEKI.YEN_AMOUNT) AS YEN_AMOUNT,
		SUM(BG_JISEKI.DOLLER_AMOUNT) AS DOLLER_AMOUNT,
		SUM(BG_JISEKI.AMOUNT) AS AMOUNT


		FROM BG_JISEKI

		INNER JOIN
		MS_VESSEL ON MS_VESSEL.MS_VESSEL_ID = BG_JISEKI.MS_VESSEL_ID

		INNER JOIN
		MS_VESSEL_TYPE ON MS_VESSEL_TYPE.MS_VESSEL_TYPE_ID = MS_VESSEL.MS_VESSEL_TYPE_ID

		WHERE
		MS_VESSEL_TYPE.MS_VESSEL_TYPE_ID = :MS_VESSEL_TYPE_ID
		AND
		BG_JISEKI.JISEKI_DATE >= :JISEKI_DATE_START
		AND
		BG_JISEKI.JISEKI_DATE &lt;= :JISEKI_DATE_END

		GROUP BY MS_KAMOKU_ID, JISEKI_DATE
		ORDER BY MS_KAMOKU_ID, JISEKI_DATE
	</sql>

  <sql name="GetRecord">
    SELECT
    BG_JISEKI.JISEKI_ID,
    BG_JISEKI.MS_VESSEL_ID,
    BG_JISEKI.MS_KAMOKU_ID,
    BG_JISEKI.JISEKI_DATE,
    BG_JISEKI.KIKAN_NO,
    BG_JISEKI.YEN_AMOUNT,
    BG_JISEKI.DOLLER_AMOUNT,
    BG_JISEKI.AMOUNT,
    BG_JISEKI.OD_SHR_ID,
    BG_JISEKI.RENEW_DATE,
    BG_JISEKI.RENEW_USER_ID,
    BG_JISEKI.TS
    FROM BG_JISEKI
    WHERE
    BG_JISEKI.JISEKI_ID = :JISEKI_ID
  </sql>

  <sql name="GetRecordsByJisekiDate">
    SELECT
    BG_JISEKI.JISEKI_ID,
    BG_JISEKI.MS_VESSEL_ID,
    BG_JISEKI.MS_KAMOKU_ID,
    BG_JISEKI.JISEKI_DATE,
    BG_JISEKI.KIKAN_NO,
    BG_JISEKI.YEN_AMOUNT,
    BG_JISEKI.DOLLER_AMOUNT,
    BG_JISEKI.AMOUNT,
    BG_JISEKI.OD_SHR_ID,
    BG_JISEKI.RENEW_DATE,
    BG_JISEKI.RENEW_USER_ID,
    BG_JISEKI.TS
    FROM BG_JISEKI
    WHERE
    BG_JISEKI.JISEKI_DATE = :JISEKI_DATE
  </sql>

  <sql name="GetRecordsByVesselTypePriodBumonHimokus">
    SELECT
    MS_HIMOKU.MS_HIMOKU_ID AS MS_KAMOKU_ID,
    SUM(BG_JISEKI.YEN_AMOUNT) AS YEN_AMOUNT,
    SUM(BG_JISEKI.DOLLER_AMOUNT) AS DOLLER_AMOUNT,
    SUM(BG_JISEKI.AMOUNT) AS AMOUNT
    FROM BG_JISEKI

    /*船をくっつける*/
    INNER JOIN  MS_VESSEL ON MS_VESSEL.MS_VESSEL_ID = BG_JISEKI.MS_VESSEL_ID
    /*費目をくっつける*/
    INNER JOIN MS_HIMOKU_KAMOKU ON MS_HIMOKU_KAMOKU.MS_KAMOKU_ID = BG_JISEKI.MS_KAMOKU_ID
    INNER JOIN MS_HIMOKU ON MS_HIMOKU.MS_HIMOKU_ID = MS_HIMOKU_KAMOKU.MS_HIMOKU_ID

    WHERE
    MS_VESSEL.MS_VESSEL_TYPE_ID = :VESSEL_TYPE AND
    BG_JISEKI.JISEKI_DATE BETWEEN :START_DATE AND :END_DATE AND
    MS_HIMOKU.MS_BUMON_ID = :BUMON_ID

    GROUP BY MS_HIMOKU.MS_HIMOKU_ID
    ORDER BY MS_HIMOKU.MS_HIMOKU_ID
  </sql>

  <sql name="GetRecordsByVesselTypePriodHimokus">
    SELECT
    MS_HIMOKU.MS_HIMOKU_ID AS MS_KAMOKU_ID,
    SUM(BG_JISEKI.YEN_AMOUNT) AS YEN_AMOUNT,
    SUM(BG_JISEKI.DOLLER_AMOUNT) AS DOLLER_AMOUNT,
    SUM(BG_JISEKI.AMOUNT) AS AMOUNT
    FROM BG_JISEKI

    /*船をくっつける*/
    INNER JOIN  MS_VESSEL ON MS_VESSEL.MS_VESSEL_ID = BG_JISEKI.MS_VESSEL_ID
    /*費目をくっつける*/
    INNER JOIN MS_HIMOKU_KAMOKU ON MS_HIMOKU_KAMOKU.MS_KAMOKU_ID = BG_JISEKI.MS_KAMOKU_ID
    INNER JOIN MS_HIMOKU ON MS_HIMOKU.MS_HIMOKU_ID = MS_HIMOKU_KAMOKU.MS_HIMOKU_ID

    WHERE
    MS_VESSEL.MS_VESSEL_TYPE_ID = :VESSEL_TYPE AND
    BG_JISEKI.JISEKI_DATE BETWEEN :START_DATE AND :END_DATE
    
    GROUP BY MS_HIMOKU.MS_HIMOKU_ID
    ORDER BY MS_HIMOKU.MS_HIMOKU_ID
  </sql>

	<sql name="InsertRecord">
    INSERT INTO BG_JISEKI
    (
    JISEKI_ID,
    MS_VESSEL_ID,
    MS_KAMOKU_ID,
    JISEKI_DATE,
    KIKAN_NO,
    YEN_AMOUNT,
    DOLLER_AMOUNT,
    AMOUNT,
    OD_SHR_ID,
    RENEW_DATE,
    RENEW_USER_ID,
    TS
    )
    VALUES
    (
    nextval('SEQ_JISEKI_ID') ,
    :MS_VESSEL_ID         ,
    :MS_KAMOKU_ID         ,
    :JISEKI_DATE          ,
    :KIKAN_NO             ,
    :YEN_AMOUNT           ,
    :DOLLER_AMOUNT        ,
    :AMOUNT               ,
    :OD_SHR_ID            ,
    :RENEW_DATE           ,
    :RENEW_USER_ID        ,
    :TS
    )
  </sql>

	<sql name="UpdateRecord">
    UPDATE BG_JISEKI SET
    MS_VESSEL_ID = :MS_VESSEL_ID,
    MS_KAMOKU_ID = :MS_KAMOKU_ID,
    JISEKI_DATE = :JISEKI_DATE,
    KIKAN_NO = :KIKAN_NO,
    YEN_AMOUNT = :YEN_AMOUNT,
    DOLLER_AMOUNT = :DOLLER_AMOUNT,
    AMOUNT = :AMOUNT,
    OD_SHR_ID = :OD_SHR_ID,
    RENEW_DATE = :RENEW_DATE,
    RENEW_USER_ID = :RENEW_USER_ID
    WHERE
    (JISEKI_ID = :JISEKI_ID) AND
    (TS = :TS)

  </sql>

  <sql name="DeleteByJisekiID">
    delete from BG_JISEKI
    where
    JISEKI_ID = :JISEKI_ID
  </sql>

  <sql name="DeleteByMsKamoku_KikanFlag">
    delete from BG_JISEKI
    where exists

    (select * from MS_KAMOKU
    where
    MS_KAMOKU.KIKAN_FLAG = 1
    and MS_KAMOKU.MS_KAMOKU_ID = BG_JISEKI.MS_KAMOKU_ID
    and JISEKI_DATE = :JISEKI_DATE)
  </sql>

  <sql name="GetMaxJisekiID">
    SELECT
    max(BG_JISEKI.JISEKI_ID) as JISEKI_ID
    FROM BG_JISEKI
  </sql>

</databaseConfig>