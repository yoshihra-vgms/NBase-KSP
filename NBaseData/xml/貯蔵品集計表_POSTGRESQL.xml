<?xml version="1.0" encoding="utf-8" ?>

<databaseConfig>

  <sql name="GetRecords潤滑油_受入合計_ORG">
    SELECT
    MS_VESSEL_ID,
    "受領年月",
    SUM("金額") AS "合計金額"

    FROM
    (
    SELECT
    a.MS_VESSEL_ID,
    TO_CHAR(d.JRY_DATE, 'YYYYMM') as "受領年月",
    CASE
    WHEN l.COUNT = 0 THEN ( h.JRY_COUNT * h.TANKA )
    WHEN l.COUNT IS NULL THEN ( h.JRY_COUNT * h.TANKA )
    ELSE ( l.COUNT * l.TANKA )
    END "金額"

    FROM
    OD_THI a
    INNER JOIN OD_MM b ON b.OD_THI_ID = a.OD_THI_ID AND b.CANCEL_FLAG = 0
    INNER JOIN OD_MK c ON c.OD_MM_ID = b.OD_MM_ID AND c.CANCEL_FLAG = 0
    INNER JOIN OD_JRY d ON d.OD_MK_ID = c.OD_MK_ID AND d.CANCEL_FLAG = 0
    INNER JOIN OD_JRY_ITEM g ON g.OD_JRY_ID = d.OD_JRY_ID AND d.CANCEL_FLAG = 0
    INNER JOIN OD_JRY_SHOUSAI_ITEM h ON h.OD_JRY_ITEM_ID = g.OD_JRY_ITEM_ID AND h.CANCEL_FLAG = 0 AND h.MS_LO_ID IS NOT NULL

    LEFT JOIN (OD_SHR e INNER JOIN (OD_SHR_ITEM k  INNER JOIN OD_SHR_SHOUSAI_ITEM l ON l.OD_SHR_ITEM_ID = k.OD_SHR_ITEM_ID AND l.CANCEL_FLAG = 0 AND l.MS_LO_ID IS NOT NULL)
    ON k.OD_SHR_ID = e.OD_SHR_ID AND k.CANCEL_FLAG = 0)
    ON e.OD_JRY_ID = d.OD_JRY_ID AND e.CANCEL_FLAG = 0 AND e.SBT = 0 AND e.STATUS = :SHR_STATUS AND h.MS_LO_ID = l.MS_LO_ID

    WHERE
    a.CANCEL_FLAG = 0
    AND a.MS_THI_IRAI_SBT_ID = :MS_THI_IRAI_SBT_ID
    AND TO_CHAR(d.JRY_DATE,'YYYYMM') >= :FROM_YYYYMM
    AND TO_CHAR(d.JRY_DATE,'YYYYMM') &lt;= :TO_YYYYMM
    )
    GROUP BY MS_VESSEL_ID, "受領年月"
    ORDER BY MS_VESSEL_ID, "受領年月"
  </sql>
  <sql name="GetRecords潤滑油_受入合計">
    SELECT
    MS_VESSEL_ID,
    "受領年月",
    SUM("金額") AS "合計金額"

    FROM
    (
    SELECT
    a.MS_VESSEL_ID,
    TO_CHAR(d.JRY_DATE, 'YYYYMM') as "受領年月",
    CASE
    WHEN l.COUNT = 0 THEN ( h.JRY_COUNT * h.TANKA )
    WHEN l.COUNT IS NULL THEN ( h.JRY_COUNT * h.TANKA )
    ELSE ( l.COUNT * l.TANKA )
    END "金額"

    FROM
    OD_THI a
    INNER JOIN OD_MM b ON b.OD_THI_ID = a.OD_THI_ID AND b.CANCEL_FLAG = 0
    INNER JOIN OD_MK c ON c.OD_MM_ID = b.OD_MM_ID AND c.CANCEL_FLAG = 0
    INNER JOIN OD_JRY d ON d.OD_MK_ID = c.OD_MK_ID AND d.CANCEL_FLAG = 0
    INNER JOIN OD_JRY_ITEM g ON g.OD_JRY_ID = d.OD_JRY_ID AND d.CANCEL_FLAG = 0
    INNER JOIN OD_JRY_SHOUSAI_ITEM h ON h.OD_JRY_ITEM_ID = g.OD_JRY_ITEM_ID AND h.CANCEL_FLAG = 0 AND h.MS_LO_ID IS NOT NULL

    LEFT JOIN (OD_SHR_SHOUSAI_ITEM l INNER JOIN (OD_SHR_ITEM k INNER JOIN OD_SHR e ON e.OD_SHR_ID = k.OD_SHR_ID AND e.CANCEL_FLAG = 0 AND e.SBT = 0 AND e.STATUS = :SHR_STATUS AND e.SYORI_STATUS in ( '3', '9' ))
    ON k.OD_SHR_ITEM_ID = l.OD_SHR_ITEM_ID AND k.CANCEL_FLAG = 0)
    ON l.OD_JRY_SHOUSAI_ITEM_ID = h.OD_JRY_SHOUSAI_ITEM_ID AND l.CANCEL_FLAG = 0
    AND l.MS_LO_ID = h.MS_LO_ID
    AND l.MS_LO_ID IS NOT NULL
    --AND e.OD_JRY_ID = d.OD_JRY_ID

    WHERE
    a.CANCEL_FLAG = 0
    AND a.MS_THI_IRAI_SBT_ID = :MS_THI_IRAI_SBT_ID
    AND TO_CHAR(d.JRY_DATE,'YYYYMM') >= :FROM_YYYYMM
    AND TO_CHAR(d.JRY_DATE,'YYYYMM') &lt;= :TO_YYYYMM
    ) as SubTBL_JUNKATUYU
    GROUP BY MS_VESSEL_ID, "受領年月"
    ORDER BY MS_VESSEL_ID, "受領年月"
  </sql>

  <sql name="GetRecords船用品_受入合計_ORG">
    SELECT
    MS_VESSEL_ID,
    "受領年月",
    SUM("金額") AS "合計金額"

    FROM
    (
    SELECT
    a.MS_VESSEL_ID,
    TO_CHAR(d.JRY_DATE, 'YYYYMM') as "受領年月",
    CASE
    WHEN l.COUNT = 0 THEN ( h.JRY_COUNT * h.TANKA )
    WHEN l.COUNT IS NULL THEN ( h.JRY_COUNT * h.TANKA )
    ELSE ( l.COUNT * l.TANKA )
    END "金額"

    FROM
    OD_THI a
    INNER JOIN OD_MM b ON b.OD_THI_ID = a.OD_THI_ID AND b.CANCEL_FLAG = 0
    INNER JOIN OD_MK c ON c.OD_MM_ID = b.OD_MM_ID AND c.CANCEL_FLAG = 0
    INNER JOIN OD_JRY d ON d.OD_MK_ID = c.OD_MK_ID AND d.CANCEL_FLAG = 0
    INNER JOIN OD_JRY_ITEM g ON g.OD_JRY_ID = d.OD_JRY_ID AND d.CANCEL_FLAG = 0
    INNER JOIN OD_JRY_SHOUSAI_ITEM h ON h.OD_JRY_ITEM_ID = g.OD_JRY_ITEM_ID AND h.CANCEL_FLAG = 0 AND h.MS_VESSEL_ITEM_ID IS NOT NULL
    INNER JOIN MS_VESSEL_ITEM i ON h.MS_VESSEL_ITEM_ID = i.MS_VESSEL_ITEM_ID AND i.CATEGORY_NUMBER = :CATEGORY_NUMBER

    LEFT JOIN (OD_SHR e INNER JOIN (OD_SHR_ITEM k  INNER JOIN OD_SHR_SHOUSAI_ITEM l ON l.OD_SHR_ITEM_ID = k.OD_SHR_ITEM_ID AND l.CANCEL_FLAG = 0 AND l.MS_VESSEL_ITEM_ID IS NOT NULL)
    ON k.OD_SHR_ID = e.OD_SHR_ID AND k.CANCEL_FLAG = 0)
    ON e.OD_JRY_ID = d.OD_JRY_ID AND e.CANCEL_FLAG = 0 AND e.SBT = 0 AND e.STATUS = :SHR_STATUS AND h.MS_VESSEL_ITEM_ID = l.MS_VESSEL_ITEM_ID

    WHERE
    a.CANCEL_FLAG = 0
    AND a.MS_THI_IRAI_SBT_ID = :MS_THI_IRAI_SBT_ID
    AND TO_CHAR(d.JRY_DATE,'YYYYMM') >= :FROM_YYYYMM
    AND TO_CHAR(d.JRY_DATE,'YYYYMM') &lt;= :TO_YYYYMM
    )
    GROUP BY MS_VESSEL_ID, "受領年月"
    ORDER BY MS_VESSEL_ID, "受領年月"
  </sql>
  <sql name="GetRecords船用品_受入合計">
    SELECT
    MS_VESSEL_ID,
    "受領年月",
    SUM("金額") AS "合計金額"

    FROM
    (
    SELECT
    a.MS_VESSEL_ID,
    TO_CHAR(d.JRY_DATE, 'YYYYMM') as "受領年月",
    CASE
    WHEN l.COUNT = 0 THEN ( h.JRY_COUNT * h.TANKA )
    WHEN l.COUNT IS NULL THEN ( h.JRY_COUNT * h.TANKA )
    ELSE ( l.COUNT * l.TANKA )
    END "金額"

    FROM
    OD_THI a
    INNER JOIN OD_MM b ON b.OD_THI_ID = a.OD_THI_ID AND b.CANCEL_FLAG = 0
    INNER JOIN OD_MK c ON c.OD_MM_ID = b.OD_MM_ID AND c.CANCEL_FLAG = 0
    INNER JOIN OD_JRY d ON d.OD_MK_ID = c.OD_MK_ID AND d.CANCEL_FLAG = 0
    INNER JOIN OD_JRY_ITEM g ON g.OD_JRY_ID = d.OD_JRY_ID AND d.CANCEL_FLAG = 0
    INNER JOIN OD_JRY_SHOUSAI_ITEM h ON h.OD_JRY_ITEM_ID = g.OD_JRY_ITEM_ID AND h.CANCEL_FLAG = 0 AND h.MS_VESSEL_ITEM_ID IS NOT NULL
    INNER JOIN MS_VESSEL_ITEM i ON h.MS_VESSEL_ITEM_ID = i.MS_VESSEL_ITEM_ID AND i.CATEGORY_NUMBER = :CATEGORY_NUMBER

    LEFT JOIN (OD_SHR_SHOUSAI_ITEM l INNER JOIN (OD_SHR_ITEM k INNER JOIN OD_SHR e ON e.OD_SHR_ID = k.OD_SHR_ID AND e.CANCEL_FLAG = 0 AND e.SBT = 0 AND e.STATUS = :SHR_STATUS AND e.SYORI_STATUS in ( '3', '9' ))
    ON k.OD_SHR_ITEM_ID = l.OD_SHR_ITEM_ID AND k.CANCEL_FLAG = 0)
    ON l.OD_JRY_SHOUSAI_ITEM_ID = h.OD_JRY_SHOUSAI_ITEM_ID AND l.CANCEL_FLAG = 0
    AND l.MS_VESSEL_ITEM_ID = h.MS_VESSEL_ITEM_ID
    AND l.MS_VESSEL_ITEM_ID IS NOT NULL
    --AND e.OD_JRY_ID = d.OD_JRY_ID

    WHERE
    a.CANCEL_FLAG = 0
    AND a.MS_THI_IRAI_SBT_ID = :MS_THI_IRAI_SBT_ID
    AND TO_CHAR(d.JRY_DATE,'YYYYMM') >= :FROM_YYYYMM
    AND TO_CHAR(d.JRY_DATE,'YYYYMM') &lt;= :TO_YYYYMM
    ) as SubTBL_ShipItem
    GROUP BY MS_VESSEL_ID, "受領年月"
    ORDER BY MS_VESSEL_ID, "受領年月"
  </sql>

</databaseConfig>