<?xml version="1.0" encoding="utf-8" ?>

<databaseConfig>

	<sql name="GetRecords">
		select distinct
		MS_DM_HOUKOKUSHO.MS_DM_HOUKOKUSHO_ID           ,
		MS_DM_HOUKOKUSHO.MS_DM_BUNRUI_ID               ,
		MS_DM_HOUKOKUSHO.MS_DM_SHOUBUNRUI_ID           ,
		MS_DM_HOUKOKUSHO.BUNSHO_NO                     ,
		MS_DM_HOUKOKUSHO.BUNSHO_NAME                   ,
		MS_DM_HOUKOKUSHO.SHUKI                         ,
		MS_DM_HOUKOKUSHO.JIKI                          ,
		MS_DM_HOUKOKUSHO.CHECK_TARGET                  ,
		MS_DM_HOUKOKUSHO.TEMPLATE_FILE_NAME            ,
		MS_DM_HOUKOKUSHO.FILE_UPDATE_DATE              ,

		MS_DM_HOUKOKUSHO.DELETE_FLAG                   ,
		MS_DM_HOUKOKUSHO.SEND_FLAG                     ,
		MS_DM_HOUKOKUSHO.VESSEL_ID                     ,
		MS_DM_HOUKOKUSHO.DATA_NO                       ,
		MS_DM_HOUKOKUSHO.USER_KEY                      ,
		MS_DM_HOUKOKUSHO.RENEW_DATE                    ,
		MS_DM_HOUKOKUSHO.RENEW_USER_ID                 ,
		MS_DM_HOUKOKUSHO.TS                            ,
		MS_DM_BUNRUI.NAME AS MS_DM_BUNRUI_NAME         ,
		MS_DM_SHOUBUNRUI.NAME AS MS_DM_SHOUBUNRUI_NAME ,
		MS_DM_BUNRUI.CODE AS MS_DM_BUNRUI_CODE         ,
		MS_DM_SHOUBUNRUI.CODE AS MS_DM_SHOUBUNRUI_CODE

		from
		MS_DM_HOUKOKUSHO
		INNER JOIN MS_DM_BUNRUI ON MS_DM_BUNRUI.MS_DM_BUNRUI_ID = MS_DM_HOUKOKUSHO.MS_DM_BUNRUI_ID
		LEFT JOIN MS_DM_SHOUBUNRUI ON MS_DM_SHOUBUNRUI.MS_DM_SHOUBUNRUI_ID = MS_DM_HOUKOKUSHO.MS_DM_SHOUBUNRUI_ID
	</sql>

	<sql name="ByBumon">
		INNER JOIN DM_PUBLISHER ON DM_PUBLISHER.LINK_SAKI_ID = MS_DM_HOUKOKUSHO.MS_DM_HOUKOKUSHO_ID
		AND DM_PUBLISHER.LINK_SAKI = :LINK_SAKI
		AND DM_PUBLISHER.KOUKAI_SAKI = :KOUKAI_SAKI
		AND DM_PUBLISHER.DELETE_FLAG = 0
		INNER JOIN MS_USER_BUMON ON MS_USER_BUMON.MS_BUMON_ID = DM_PUBLISHER.MS_BUMON_ID
		AND MS_USER_BUMON.MS_USER_ID = :MS_USER_ID

		WHERE (MS_DM_HOUKOKUSHO.DELETE_FLAG = 0 or MS_DM_HOUKOKUSHO.DELETE_FLAG is NULL)
	</sql>

<!--
	<sql name="ByKaichoShacho">
		INNER JOIN DM_PUBLISHER ON DM_PUBLISHER.LINK_SAKI_ID = MS_DM_HOUKOKUSHO.MS_DM_HOUKOKUSHO_ID
		AND DM_PUBLISHER.LINK_SAKI = :LINK_SAKI
		AND DM_PUBLISHER.KOUKAI_SAKI = :KOUKAI_SAKI_KAICHO_SHACHO
		AND DM_PUBLISHER.DELETE_FLAG = 0

		WHERE (MS_DM_HOUKOKUSHO.DELETE_FLAG = 0 or MS_DM_HOUKOKUSHO.DELETE_FLAG is NULL)
	</sql>

	<sql name="BySekininsha">
		INNER JOIN DM_PUBLISHER ON DM_PUBLISHER.LINK_SAKI_ID = MS_DM_HOUKOKUSHO.MS_DM_HOUKOKUSHO_ID
		AND DM_PUBLISHER.LINK_SAKI = :LINK_SAKI
		AND DM_PUBLISHER.KOUKAI_SAKI = :KOUKAI_SAKI_SEKININSHA
		AND DM_PUBLISHER.DELETE_FLAG = 0

		WHERE (MS_DM_HOUKOKUSHO.DELETE_FLAG = 0 or MS_DM_HOUKOKUSHO.DELETE_FLAG is NULL)
	</sql>
-->
	<sql name="ByRole">
		INNER JOIN DM_PUBLISHER ON DM_PUBLISHER.LINK_SAKI_ID = MS_DM_HOUKOKUSHO.MS_DM_HOUKOKUSHO_ID
		AND DM_PUBLISHER.LINK_SAKI = :LINK_SAKI
		AND DM_PUBLISHER.KOUKAI_SAKI = :KOUKAI_SAKI_ROLE
		AND DM_PUBLISHER.DELETE_FLAG = 0

		WHERE (MS_DM_HOUKOKUSHO.DELETE_FLAG = 0 or MS_DM_HOUKOKUSHO.DELETE_FLAG is NULL)
	</sql>
	
	<sql name="ByMsDmBunruiID">
		AND MS_DM_HOUKOKUSHO.MS_DM_BUNRUI_ID = :MS_DM_BUNRUI_ID
	</sql>

	<sql name="ByMsDmShoubunruiID">
		AND MS_DM_HOUKOKUSHO.MS_DM_SHOUBUNRUI_ID = :MS_DM_SHOUBUNRUI_ID
	</sql>

	<sql name="LikeBunshoNo">
		and MS_DM_HOUKOKUSHO.BUNSHO_NO LIKE :BUNSHO_NO
	</sql>

	<sql name="LikeBunshoName">
		and MS_DM_HOUKOKUSHO.BUNSHO_NAME LIKE :BUNSHO_NAME
	</sql>

	<sql name="OrderBy">
		Order By
		--MS_DM_BUNRUI_CODE,
		--MS_DM_BUNRUI_NAME,
		--MS_DM_SHOUBUNRUI_CODE,
		--MS_DM_SHOUBUNRUI_NAME,
		BUNSHO_NO,
		BUNSHO_NAME
	</sql>


	<sql name="GetRecords未提出一覧">
		select distinct
		MS_DM_HOUKOKUSHO.MS_DM_HOUKOKUSHO_ID           ,
		MS_DM_HOUKOKUSHO.MS_DM_BUNRUI_ID               ,
		MS_DM_HOUKOKUSHO.MS_DM_SHOUBUNRUI_ID           ,
		MS_DM_HOUKOKUSHO.BUNSHO_NO                     ,
		MS_DM_HOUKOKUSHO.BUNSHO_NAME                   ,
		MS_DM_HOUKOKUSHO.SHUKI                         ,
		MS_DM_HOUKOKUSHO.JIKI                          ,

		MS_DM_BUNRUI.NAME AS MS_DM_BUNRUI_NAME         ,
		MS_DM_SHOUBUNRUI.NAME AS MS_DM_SHOUBUNRUI_NAME ,
		MS_DM_BUNRUI.CODE AS MS_DM_BUNRUI_CODE         ,
		MS_DM_SHOUBUNRUI.CODE AS MS_DM_SHOUBUNRUI_CODE

		from
		MS_DM_HOUKOKUSHO
		INNER JOIN MS_DM_BUNRUI ON MS_DM_BUNRUI.MS_DM_BUNRUI_ID = MS_DM_HOUKOKUSHO.MS_DM_BUNRUI_ID
		LEFT JOIN MS_DM_SHOUBUNRUI ON MS_DM_SHOUBUNRUI.MS_DM_SHOUBUNRUI_ID = MS_DM_HOUKOKUSHO.MS_DM_SHOUBUNRUI_ID
		INNER JOIN DM_PUBLISHER ON DM_PUBLISHER.LINK_SAKI_ID = MS_DM_HOUKOKUSHO.MS_DM_HOUKOKUSHO_ID
		AND DM_PUBLISHER.LINK_SAKI = :LINK_SAKI
		AND DM_PUBLISHER.DELETE_FLAG = 0

		WHERE
		-- 現在、報告書マスタで有効なもの
		((MS_DM_HOUKOKUSHO.DELETE_FLAG = 0 or MS_DM_HOUKOKUSHO.DELETE_FLAG is NULL) and MS_DM_HOUKOKUSHO.CHECK_TARGET = 1)
	</sql>
	<sql name="GetRecords未提出一覧_OLD">
		select distinct
		MS_DM_HOUKOKUSHO.MS_DM_HOUKOKUSHO_ID           ,
		MS_DM_HOUKOKUSHO.MS_DM_BUNRUI_ID               ,
		MS_DM_HOUKOKUSHO.MS_DM_SHOUBUNRUI_ID           ,
		MS_DM_HOUKOKUSHO.BUNSHO_NO                     ,
		MS_DM_HOUKOKUSHO.BUNSHO_NAME                   ,
		MS_DM_HOUKOKUSHO.SHUKI                         ,
		MS_DM_HOUKOKUSHO.JIKI                          ,

		MS_DM_BUNRUI.NAME AS MS_DM_BUNRUI_NAME         ,
		MS_DM_SHOUBUNRUI.NAME AS MS_DM_SHOUBUNRUI_NAME ,
		MS_DM_BUNRUI.CODE AS MS_DM_BUNRUI_CODE         ,
		MS_DM_SHOUBUNRUI.CODE AS MS_DM_SHOUBUNRUI_CODE

		from
		MS_DM_HOUKOKUSHO
		INNER JOIN MS_DM_BUNRUI ON MS_DM_BUNRUI.MS_DM_BUNRUI_ID = MS_DM_HOUKOKUSHO.MS_DM_BUNRUI_ID
		LEFT JOIN MS_DM_SHOUBUNRUI ON MS_DM_SHOUBUNRUI.MS_DM_SHOUBUNRUI_ID = MS_DM_HOUKOKUSHO.MS_DM_SHOUBUNRUI_ID
		INNER JOIN DM_PUBLISHER ON DM_PUBLISHER.LINK_SAKI_ID = MS_DM_HOUKOKUSHO.MS_DM_HOUKOKUSHO_ID
		AND DM_PUBLISHER.LINK_SAKI = :LINK_SAKI
		AND DM_PUBLISHER.DELETE_FLAG = 0

		WHERE
		(
		-- 現在、報告書マスタで有効なもの
		((MS_DM_HOUKOKUSHO.DELETE_FLAG = 0 or MS_DM_HOUKOKUSHO.DELETE_FLAG is NULL) and MS_DM_HOUKOKUSHO.CHECK_TARGET = 1)
		OR
		-- 指定年度で実績（管理記録登録）があるもの
		(MS_DM_HOUKOKUSHO_ID IN
		(SELECT MS_DM_HOUKOKUSHO_ID
		FROM DM_KANRI_KIROKU
		WHERE (DM_KANRI_KIROKU.DELETE_FLAG = 0 or DM_KANRI_KIROKU.DELETE_FLAG is NULL)
		AND (( JIKI_NEN = :JIKI_NEN AND JIKI_TUKI >= 4 ) OR ( JIKI_NEN = :JIKI_YOKU_NEN AND JIKI_TUKI &lt; 4 )))
		)
		)
	</sql>

</databaseConfig>
