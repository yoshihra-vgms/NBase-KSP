<?xml version="1.0" encoding="utf-8" ?>

<databaseConfig>

  <sql name="GetRecords_入渠">
    SELECT
    BG_UCHIWAKE_YOSAN_ITEM.BG_UCHIWAKE_YOSAN_ITEM_ID,
    BG_UCHIWAKE_YOSAN_ITEM.VESSEL_YOSAN_ID,
    BG_UCHIWAKE_YOSAN_ITEM.NENGETSU,
    BG_UCHIWAKE_YOSAN_ITEM.MS_HIMOKU_ID,
    BG_UCHIWAKE_YOSAN_ITEM.AMOUNT,
    BG_UCHIWAKE_YOSAN_ITEM.BIKOU,
    BG_UCHIWAKE_YOSAN_ITEM.SHOW_ORDER,
    BG_UCHIWAKE_YOSAN_ITEM.DELETE_FLAG,
    BG_UCHIWAKE_YOSAN_ITEM.RENEW_DATE,
    BG_UCHIWAKE_YOSAN_ITEM.RENEW_USER_ID,
    BG_UCHIWAKE_YOSAN_ITEM.TS

    FROM
    BG_UCHIWAKE_YOSAN_ITEM

    INNER JOIN
    BG_VESSEL_YOSAN ON BG_VESSEL_YOSAN.VESSEL_YOSAN_ID = BG_UCHIWAKE_YOSAN_ITEM.VESSEL_YOSAN_ID

    INNER JOIN
    BG_YOSAN_HEAD ON BG_YOSAN_HEAD.YOSAN_HEAD_ID = BG_VESSEL_YOSAN.YOSAN_HEAD_ID

    WHERE
    BG_YOSAN_HEAD.YOSAN_HEAD_ID = :YOSAN_HEAD_ID
    AND
    BG_VESSEL_YOSAN.MS_VESSEL_ID = :MS_VESSEL_ID
    AND
    BG_VESSEL_YOSAN.YEAR >= :YEAR_START
    AND
    BG_VESSEL_YOSAN.YEAR &lt;= :YEAR_END
    AND
    LENGTH(TRIM(BG_UCHIWAKE_YOSAN_ITEM.NENGETSU)) = 4

    AND
    DELETE_FLAG = 0

    ORDER BY
    BG_UCHIWAKE_YOSAN_ITEM.MS_HIMOKU_ID,
    BG_UCHIWAKE_YOSAN_ITEM.VESSEL_YOSAN_ID,
    BG_UCHIWAKE_YOSAN_ITEM.SHOW_ORDER
  </sql>

  <sql name="InsertRecord">
    INSERT INTO BG_UCHIWAKE_YOSAN_ITEM
    (
    BG_UCHIWAKE_YOSAN_ITEM_ID,
    VESSEL_YOSAN_ID,
    NENGETSU,
    MS_HIMOKU_ID,
    AMOUNT,
    BIKOU,
    SHOW_ORDER,
    DELETE_FLAG,
    RENEW_DATE,
    RENEW_USER_ID,
    TS
    )
    VALUES
    (
    nextval('SEQ_BG_UCHIWAKE_YOSAN_ITEM_ID'),
    :VESSEL_YOSAN_ID,
    :NENGETSU,
    :MS_HIMOKU_ID,
    :AMOUNT,
    :BIKOU,
    :SHOW_ORDER,
    :DELETE_FLAG,
    :RENEW_DATE,
    :RENEW_USER_ID,
    :TS
    )
  </sql>

  <sql name="UpdateRecord">
    UPDATE BG_UCHIWAKE_YOSAN_ITEM SET

    VESSEL_YOSAN_ID = :VESSEL_YOSAN_ID,
    NENGETSU = :NENGETSU,
    MS_HIMOKU_ID = :MS_HIMOKU_ID,
    AMOUNT = :AMOUNT,
    BIKOU = :BIKOU,
    SHOW_ORDER = :SHOW_ORDER,
    DELETE_FLAG = :DELETE_FLAG,
    RENEW_DATE = :RENEW_DATE,
    RENEW_USER_ID = :RENEW_USER_ID
    WHERE
    (BG_UCHIWAKE_YOSAN_ITEM_ID = :BG_UCHIWAKE_YOSAN_ITEM_ID) AND
    (TS = :TS)
  </sql>

  <sql name="InsertRecords_コピー">
    INSERT INTO BG_UCHIWAKE_YOSAN_ITEM
    (
    BG_UCHIWAKE_YOSAN_ITEM_ID,
    VESSEL_YOSAN_ID,
    NENGETSU,
    MS_HIMOKU_ID,
    AMOUNT,
    BIKOU,
    SHOW_ORDER,
    DELETE_FLAG,
    RENEW_DATE,
    RENEW_USER_ID
    )

    SELECT
    nextval('SEQ_BG_UCHIWAKE_YOSAN_ITEM_ID'),
    :VESSEL_YOSAN_ID,
    NENGETSU,
    MS_HIMOKU_ID,
    AMOUNT,
    BIKOU,
    SHOW_ORDER,
    DELETE_FLAG,
    :RENEW_DATE,
    :RENEW_USER_ID

    FROM
    BG_UCHIWAKE_YOSAN_ITEM

    JOIN
    BG_VESSEL_YOSAN
    ON BG_VESSEL_YOSAN.VESSEL_YOSAN_ID = BG_UCHIWAKE_YOSAN_ITEM.VESSEL_YOSAN_ID
    JOIN
    BG_YOSAN_HEAD
    ON BG_YOSAN_HEAD.YOSAN_HEAD_ID = BG_VESSEL_YOSAN.YOSAN_HEAD_ID

    WHERE
    BG_YOSAN_HEAD.YOSAN_HEAD_ID = :LAST_YOSAN_HEAD_ID
    AND
    BG_VESSEL_YOSAN.MS_VESSEL_ID = :MS_VESSEL_ID
    AND
    BG_VESSEL_YOSAN.YEAR = :VESSEL_YOSAN_YEAR
  </sql>

  <sql name="ExistsLastRecord">
    SELECT
    COUNT(*)

    FROM
    BG_UCHIWAKE_YOSAN_ITEM

    JOIN
    BG_VESSEL_YOSAN
    ON BG_VESSEL_YOSAN.VESSEL_YOSAN_ID = BG_UCHIWAKE_YOSAN_ITEM.VESSEL_YOSAN_ID
    JOIN
    BG_YOSAN_HEAD
    ON BG_YOSAN_HEAD.YOSAN_HEAD_ID = BG_VESSEL_YOSAN.YOSAN_HEAD_ID

    WHERE
    BG_YOSAN_HEAD.YOSAN_HEAD_ID = :LAST_YOSAN_HEAD_ID
    AND
    BG_VESSEL_YOSAN.MS_VESSEL_ID = :MS_VESSEL_ID
    AND
    BG_VESSEL_YOSAN.YEAR = :VESSEL_YOSAN_YEAR
  </sql>

</databaseConfig>