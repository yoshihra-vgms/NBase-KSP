<?xml version="1.0" encoding="utf-8" ?>

<databaseConfig>

	<sql name="GetRecords">
		SELECT
		HOUKOKUSHO_PUB.KOUKAI_SAKI ,
		MS_VESSEL.VESSEL_NAME AS MS_VESSEL_NAME ,
		MS_VESSEL.SHOW_ORDER AS MS_VESSEL_ORDER ,
		HOUKOKUSHO_PUB.MS_BUMON_ID AS MS_BUMON_ID ,
		MS_BUMON.BUMON_NAME AS MS_BUMON_NAME,
		KANRI_KIROKU.JIKI_NEN ,
		KANRI_KIROKU.JIKI_TUKI ,
		KANRI_KIROKU.ISSUE_DATE ,
		DM_ALARM_INFO.HAASEI_DATE

		FROM
		(
		SELECT
		LINK_SAKI_ID,
		KOUKAI_SAKI,
		CASE WHEN MS_VESSEL_ID IS NULL THEN 0
		ELSE MS_VESSEL_ID
		END MS_VESSEL_ID,
		CASE WHEN MS_BUMON_ID IS NULL THEN 'NULL'
		ELSE MS_BUMON_ID
		END MS_BUMON_ID

		FROM
		DM_PUBLISHER

		WHERE (DM_PUBLISHER.DELETE_FLAG = 0 or DM_PUBLISHER.DELETE_FLAG is NULL)
		AND LINK_SAKI_ID = :MS_DM_HOUKOKUSHO_ID
		) HOUKOKUSHO_PUB

		LEFT JOIN MS_VESSEL ON MS_VESSEL.MS_VESSEL_ID = HOUKOKUSHO_PUB.MS_VESSEL_ID
		LEFT JOIN MS_BUMON ON MS_BUMON.MS_BUMON_ID = HOUKOKUSHO_PUB.MS_BUMON_ID

		LEFT JOIN
		(
		SELECT
		DM_KANRI_KIROKU.JIKI_NEN ,
		DM_KANRI_KIROKU.JIKI_TUKI ,
		DM_KANRI_KIROKU.ISSUE_DATE ,
		DM_PUBLISHER.KOUKAI_SAKI,
		CASE WHEN DM_PUBLISHER.MS_VESSEL_ID IS NULL THEN 0
		ELSE DM_PUBLISHER.MS_VESSEL_ID
		END MS_VESSEL_ID,
		CASE WHEN DM_PUBLISHER.MS_BUMON_ID IS NULL THEN 'NULL'
		ELSE DM_PUBLISHER.MS_BUMON_ID
		END MS_BUMON_ID

		FROM
		DM_KANRI_KIROKU
		INNER JOIN DM_PUBLISHER ON DM_PUBLISHER.LINK_SAKI_ID = DM_KANRI_KIROKU.DM_KANRI_KIROKU_ID

		WHERE DM_KANRI_KIROKU.MS_DM_HOUKOKUSHO_ID = :MS_DM_HOUKOKUSHO_ID
		AND (DM_KANRI_KIROKU.DELETE_FLAG = 0 or DM_KANRI_KIROKU.DELETE_FLAG is NULL)
		AND ((DM_KANRI_KIROKU.JIKI_NEN = :JIKI_NEN AND DM_KANRI_KIROKU.JIKI_TUKI >= 4) OR
		(DM_KANRI_KIROKU.JIKI_NEN = :JIKI_YOKU_NEN AND DM_KANRI_KIROKU.JIKI_TUKI &lt; 4))
		) KANRI_KIROKU

		ON KANRI_KIROKU.KOUKAI_SAKI = HOUKOKUSHO_PUB.KOUKAI_SAKI
		AND KANRI_KIROKU.KOUKAI_SAKI = HOUKOKUSHO_PUB.KOUKAI_SAKI
		AND KANRI_KIROKU.MS_VESSEL_ID = HOUKOKUSHO_PUB.MS_VESSEL_ID
		AND KANRI_KIROKU.MS_BUMON_ID = HOUKOKUSHO_PUB.MS_BUMON_ID


		LEFT JOIN
		(
		SELECT
		PT_DM_ALARM_INFO.KOUKAI_SAKI ,
		CASE WHEN PT_DM_ALARM_INFO.MS_VESSEL_ID IS NULL THEN 0
		ELSE PT_DM_ALARM_INFO.MS_VESSEL_ID
		END MS_VESSEL_ID,
		CASE WHEN PT_DM_ALARM_INFO.MS_BUMON_ID IS NULL THEN 'NULL'
		ELSE PT_DM_ALARM_INFO.MS_BUMON_ID
		END MS_BUMON_ID,
		PT_ALARM_INFO.HAASEI_DATE

		FROM
		PT_DM_ALARM_INFO
		LEFT JOIN PT_ALARM_INFO ON PT_DM_ALARM_INFO.PT_ALARM_INFO_ID = PT_ALARM_INFO.PT_ALARM_INFO_ID
		AND TO_CHAR(PT_ALARM_INFO.HAASEI_DATE,'YYYY/MM/DD') &lt;= :TODAY
		AND PT_ALARM_INFO.ALARM_SHOW_FLAG = :ALARM_SHOW_FLAG
		AND PT_ALARM_INFO.DELETE_FLAG = 0


		WHERE PT_DM_ALARM_INFO.MS_DM_HOUKOKUSHO_ID = :MS_DM_HOUKOKUSHO_ID
		AND (PT_DM_ALARM_INFO.DELETE_FLAG = 0 or PT_DM_ALARM_INFO.DELETE_FLAG is NULL)
		AND ((PT_DM_ALARM_INFO.JIKI_NEN = :JIKI_NEN AND PT_DM_ALARM_INFO.JIKI_TUKI >= 4) OR
		(PT_DM_ALARM_INFO.JIKI_NEN = :JIKI_YOKU_NEN AND PT_DM_ALARM_INFO.JIKI_TUKI &lt; 4))


		) DM_ALARM_INFO

		ON DM_ALARM_INFO.KOUKAI_SAKI = HOUKOKUSHO_PUB.KOUKAI_SAKI
		AND DM_ALARM_INFO.MS_VESSEL_ID = HOUKOKUSHO_PUB.MS_VESSEL_ID
		AND DM_ALARM_INFO.MS_BUMON_ID = HOUKOKUSHO_PUB.MS_BUMON_ID

	</sql>

</databaseConfig>
