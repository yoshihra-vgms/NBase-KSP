<?xml version="1.0" encoding="utf-8" ?>

<databaseConfig>

	<sql name="GetRecords">
    SELECT
    BG_UNKOUHI.BG_UNKOUHI_ID,
    BG_UNKOUHI.VESSEL_YOSAN_ID,
    BG_UNKOUHI.OBJECT_DATA,
    BG_UNKOUHI.RENEW_DATE,
    BG_UNKOUHI.RENEW_USER_ID,
    BG_UNKOUHI.TS,

    BG_VESSEL_YOSAN.YEAR

    FROM BG_UNKOUHI

    JOIN
    BG_VESSEL_YOSAN
    ON BG_VESSEL_YOSAN.VESSEL_YOSAN_ID = BG_UNKOUHI.VESSEL_YOSAN_ID
  </sql>

  <sql name="ByYosanHeadIdAndMsVesselIdAndYear">
    JOIN
    BG_YOSAN_HEAD
    ON BG_YOSAN_HEAD.YOSAN_HEAD_ID = BG_VESSEL_YOSAN.YOSAN_HEAD_ID

    WHERE
    BG_YOSAN_HEAD.YOSAN_HEAD_ID = :YOSAN_HEAD_ID
    AND
    BG_VESSEL_YOSAN.MS_VESSEL_ID = :MS_VESSEL_ID
    AND
    BG_VESSEL_YOSAN.YEAR = :YEAR
  </sql>

  <sql name="InsertRecord">
    INSERT INTO BG_UNKOUHI
    (
    BG_UNKOUHI_ID,
    VESSEL_YOSAN_ID,
    OBJECT_DATA,
    RENEW_DATE,
    RENEW_USER_ID,
    TS
    )
    VALUES
    (
    nextval('SEQ_BG_UNKOUHI_ID'),
    :VESSEL_YOSAN_ID,
    :OBJECT_DATA,
    :RENEW_DATE,
    :RENEW_USER_ID,
    :TS
    )
  </sql>

	<sql name="UpdateRecord">
    UPDATE BG_UNKOUHI SET

    VESSEL_YOSAN_ID = :VESSEL_YOSAN_ID,
    OBJECT_DATA = :OBJECT_DATA,
    RENEW_DATE = :RENEW_DATE,
    RENEW_USER_ID = :RENEW_USER_ID
    WHERE
    (BG_UNKOUHI_ID = :BG_UNKOUHI_ID) AND
    (TS = :TS)
  </sql>

  <sql name="UpdateRecords_コピー">
    UPDATE BG_UNKOUHI A
    SET A.OBJECT_DATA = :OBJECT_DATA
    WHERE A.BG_UNKOUHI_ID IN
    (
    SELECT
    B.BG_UNKOUHI_ID

    FROM BG_UNKOUHI B

    JOIN
    BG_VESSEL_YOSAN
    ON BG_VESSEL_YOSAN.VESSEL_YOSAN_ID = B.VESSEL_YOSAN_ID
    JOIN
    BG_YOSAN_HEAD
    ON BG_YOSAN_HEAD.YOSAN_HEAD_ID = BG_VESSEL_YOSAN.YOSAN_HEAD_ID

    WHERE
    BG_YOSAN_HEAD.YOSAN_HEAD_ID = :YOSAN_HEAD_ID
    AND
    BG_VESSEL_YOSAN.MS_VESSEL_ID = :MS_VESSEL_ID
    AND
    BG_VESSEL_YOSAN.YEAR >= :YEAR
    )
  </sql>

  <sql name="InsertRecords_コピー">
    INSERT INTO BG_UNKOUHI
    (
    BG_UNKOUHI_ID,
    VESSEL_YOSAN_ID,
    OBJECT_DATA,
    RENEW_DATE,
    RENEW_USER_ID
    )

    SELECT
    nextval('SEQ_BG_UNKOUHI_ID'),
    :VESSEL_YOSAN_ID,
    OBJECT_DATA,
    :RENEW_DATE,
    :RENEW_USER_ID

    FROM
    BG_UNKOUHI

    JOIN
    BG_VESSEL_YOSAN
    ON BG_VESSEL_YOSAN.VESSEL_YOSAN_ID = BG_UNKOUHI.VESSEL_YOSAN_ID
    JOIN
    BG_YOSAN_HEAD
    ON BG_YOSAN_HEAD.YOSAN_HEAD_ID = BG_VESSEL_YOSAN.YOSAN_HEAD_ID

    WHERE
    BG_YOSAN_HEAD.YOSAN_HEAD_ID = :LAST_YOSAN_HEAD_ID
    AND
    BG_VESSEL_YOSAN.MS_VESSEL_ID = :MS_VESSEL_ID
    AND
    BG_VESSEL_YOSAN.YEAR = :VESSEL_YOSAN_YEAR
  </sql>

  <sql name="ExistsLastRecord">
    SELECT
    COUNT(*)

    FROM
    BG_UNKOUHI

    JOIN
    BG_VESSEL_YOSAN
    ON BG_VESSEL_YOSAN.VESSEL_YOSAN_ID = BG_UNKOUHI.VESSEL_YOSAN_ID
    JOIN
    BG_YOSAN_HEAD
    ON BG_YOSAN_HEAD.YOSAN_HEAD_ID = BG_VESSEL_YOSAN.YOSAN_HEAD_ID

    WHERE
    BG_YOSAN_HEAD.YOSAN_HEAD_ID = :LAST_YOSAN_HEAD_ID
    AND
    BG_VESSEL_YOSAN.MS_VESSEL_ID = :MS_VESSEL_ID
    AND
    BG_VESSEL_YOSAN.YEAR = :VESSEL_YOSAN_YEAR
  </sql>

</databaseConfig>
